#!/usr/bin/env node
/**
 * AIåº—é•¿ - é€‰å“åˆ†æžæ¨¡å—
 * åˆ†æžå¸‚åœºè¶‹åŠ¿ï¼Œå‘çŽ°è“æµ·å“ç±»
 */

// çƒ­é—¨å“ç±»æ•°æ®æº
const TREND_SOURCES = {
  taobao_hot: {
    name: 'æ·˜å®çƒ­æœ',
    query: (category) => `${category} æ·˜å® çƒ­å– 2026 è¶‹åŠ¿ é”€é‡æŽ’è¡Œ`
  },
  pdd_hot: {
    name: 'æ‹¼å¤šå¤šçˆ†æ¬¾',
    query: (category) => `${category} æ‹¼å¤šå¤š çˆ†æ¬¾ çƒ­é”€ æŽ’è¡Œ`
  },
  xiaohongshu_trend: {
    name: 'å°çº¢ä¹¦è¶‹åŠ¿',
    query: (category) => `${category} å°çº¢ä¹¦ ç§è‰ çƒ­é—¨ è¶‹åŠ¿ 2026`
  },
  alibaba_supply: {
    name: '1688è´§æº',
    query: (category) => `${category} 1688 å·¥åŽ‚ æ‰¹å‘ è´§æº åˆ©æ¶¦`
  },
  seasonal: {
    name: 'å­£èŠ‚æ€§åˆ†æž',
    query: (category) => `${category} å­£èŠ‚ æ—ºå­£ æ·¡å­£ é”€å”®å‘¨æœŸ`
  }
};

// å­£èŠ‚æ€§å“ç±»å‚è€ƒ
const SEASONAL_CATEGORIES = {
  spring: ['æ˜¥è£…', 'é˜²æ™’', 'è¸é’è£…å¤‡', 'æ¸…æ´ç”¨å“', 'æ”¶çº³', 'å¥èº«å™¨æ'],
  summer: ['é˜²æ™’', 'å†°ä¸', 'éœ²è¥', 'æ³³è£…', 'é©±èšŠ', 'å°é£Žæ‰‡', 'å†°ç®±æ”¶çº³'],
  autumn: ['ç§‹è£…', 'ä¿æ¸©æ¯', 'æŠ¤è‚¤', 'æœˆé¥¼', 'å¼€å­¦ç”¨å“', 'å›´å·¾'],
  winter: ['ç¾½ç»’æœ', 'æš–æ‰‹å®', 'åŠ ç»’', 'å¹´è´§', 'åœ£è¯ž', 'æ»‘é›ªè£…å¤‡', 'ç”µçƒ­æ¯¯']
};

/**
 * ç”Ÿæˆé€‰å“åˆ†æž prompt
 * @param {string} category - å“ç±»æˆ–æ–¹å‘æè¿°
 * @param {object} options - é¢„ç®—ã€ç»éªŒç­‰
 */
function buildSelectionPrompt(category, options = {}) {
  const budget = options.budget || 'ä¸é™';
  const experience = options.experience || 'æ–°æ‰‹';
  const currentMonth = new Date().getMonth() + 1;

  // åˆ¤æ–­å½“å‰å­£èŠ‚
  let season;
  if (currentMonth >= 3 && currentMonth <= 5) season = 'spring';
  else if (currentMonth >= 6 && currentMonth <= 8) season = 'summer';
  else if (currentMonth >= 9 && currentMonth <= 11) season = 'autumn';
  else season = 'winter';

  const seasonalItems = SEASONAL_CATEGORIES[season].join('ã€');

  return `ä½ æ˜¯ä¸€ä¸ªèµ„æ·±ç”µå•†é€‰å“ä¸“å®¶ï¼Œå¸®åŠ©å–å®¶å‘çŽ°èµšé’±çš„å“ç±»ã€‚

ç”¨æˆ·æƒ…å†µï¼š
- å…³æ³¨æ–¹å‘ï¼š${category || 'ä¸ç¡®å®šï¼Œéœ€è¦æŽ¨è'}
- é¢„ç®—ï¼š${budget}
- ç»éªŒï¼š${experience}
- å½“å‰æœˆä»½ï¼š${currentMonth}æœˆï¼ˆ${season === 'spring' ? 'æ˜¥å­£' : season === 'summer' ? 'å¤å­£' : season === 'autumn' ? 'ç§‹å­£' : 'å†¬å­£'}ï¼‰

å½“å‰å­£èŠ‚çƒ­é—¨å“ç±»å‚è€ƒï¼š${seasonalItems}

è¯·ä»Žä»¥ä¸‹ç»´åº¦åˆ†æžå¹¶æŽ¨èï¼š

## 1. å¸‚åœºåˆ†æž
- è¿™ä¸ªå“ç±»/æ–¹å‘çš„æ•´ä½“å¸‚åœºè§„æ¨¡
- ç«žäº‰æ¿€çƒˆç¨‹åº¦ï¼ˆçº¢æµ·/è“æµ·ï¼‰
- åˆ©æ¶¦ç©ºé—´é¢„ä¼°

## 2. æŽ¨èé€‰å“ï¼ˆ3-5ä¸ªå…·ä½“äº§å“æ–¹å‘ï¼‰
æ¯ä¸ªæŽ¨èåŒ…å«ï¼š
- äº§å“åç§°å’Œæè¿°
- é¢„ä¼°å”®ä»·åŒºé—´
- é¢„ä¼°åˆ©æ¶¦çŽ‡
- ç›®æ ‡äººç¾¤
- æŽ¨èç†ç”±
- é£Žé™©æç¤º

## 3. è´§æºå»ºè®®
- 1688 æœç´¢å…³é”®è¯
- é¢„ä¼°æ‹¿è´§ä»·
- èµ·æ‰¹é‡å»ºè®®
- è´¨æ£€è¦ç‚¹

## 4. è¿è¥å»ºè®®
- æŽ¨èé¦–å‘å¹³å°
- å®šä»·ç­–ç•¥
- æŽ¨å¹¿æ–¹å¼
- é¢„ä¼°å›žæœ¬å‘¨æœŸ

## 5. é¿å‘æŒ‡å—
- è¿™ä¸ªå“ç±»å¸¸è§çš„å‘
- éœ€è¦æ³¨æ„çš„èµ„è´¨/è®¤è¯
- å­£èŠ‚æ€§é£Žé™©

è¯·ç”¨å¤§ç™½è¯å›žç­”ï¼Œé€‚åˆ${experience}å–å®¶ç†è§£ã€‚ç»™å‡ºå…·ä½“å¯æ‰§è¡Œçš„å»ºè®®ï¼Œä¸è¦ç©ºæ³›çš„ç†è®ºã€‚`;
}

/**
 * ç”Ÿæˆè¶‹åŠ¿åˆ†æž prompt
 */
function buildTrendPrompt(searchResults) {
  return `ä½ æ˜¯ä¸€ä¸ªç”µå•†æ•°æ®åˆ†æžå¸ˆã€‚æ ¹æ®ä»¥ä¸‹æœç´¢æ•°æ®ï¼Œåˆ†æžå½“å‰ç”µå•†å¸‚åœºè¶‹åŠ¿ã€‚

æœç´¢æ•°æ®ï¼š
${JSON.stringify(searchResults, null, 2)}

è¯·åˆ†æžï¼š
1. å½“å‰æœ€çƒ­é—¨çš„å“ç±»/äº§å“æ˜¯ä»€ä¹ˆ
2. æœ‰å“ªäº›æ­£åœ¨ä¸Šå‡çš„æ–°è¶‹åŠ¿
3. å“ªäº›å“ç±»ç«žäº‰ç›¸å¯¹è¾ƒå°ä½†éœ€æ±‚åœ¨å¢žé•¿ï¼ˆè“æµ·æœºä¼šï¼‰
4. è¿‘æœŸæœ‰ä»€ä¹ˆå€¼å¾—å…³æ³¨çš„æ¶ˆè´¹è¶‹åŠ¿å˜åŒ–
5. ç»™å‡º3ä¸ªå…·ä½“çš„é€‰å“å»ºè®®

ç”¨ç®€æ´çš„ä¸­æ–‡å›žç­”ï¼Œé‡ç‚¹çªå‡ºå¯æ“ä½œçš„ä¿¡æ¯ã€‚`;
}

/**
 * ç”Ÿæˆæ•°æ®æ—¥æŠ¥ prompt
 */
function buildDailyReportPrompt(keyword, todayData, yesterdayData) {
  return `ä½ æ˜¯AIåº—é•¿ï¼Œè¯·ç”Ÿæˆä»Šæ—¥çš„ç«žå“ç›‘æŽ§æ—¥æŠ¥ã€‚

ç›‘æŽ§å…³é”®è¯ï¼š${keyword}
ä»Šæ—¥æ•°æ®ï¼š${JSON.stringify(todayData, null, 2)}
${yesterdayData ? `æ˜¨æ—¥æ•°æ®ï¼š${JSON.stringify(yesterdayData, null, 2)}` : 'ï¼ˆé¦–æ¬¡ç›‘æŽ§ï¼Œæ— åŽ†å²æ•°æ®ï¼‰'}

è¯·ç”Ÿæˆç®€æ´çš„æ—¥æŠ¥ï¼ŒåŒ…å«ï¼š

ðŸ“Š **${keyword} æ—¥æŠ¥** â€” ${new Date().toLocaleDateString('zh-CN')}

1. **ä»·æ ¼å˜åŠ¨**ï¼šæœ‰æ— æ˜Žæ˜¾æ¶¨è·Œ
2. **æ–°å“ä¸Šæž¶**ï¼šå‘çŽ°çš„æ–°ç«žå“
3. **çƒ­æœè¯å˜åŒ–**ï¼šå…³é”®è¯è¶‹åŠ¿
4. **å€¼å¾—å…³æ³¨**ï¼šä»»ä½•å¼‚å¸¸æˆ–æœºä¼š
5. **è¡ŒåŠ¨å»ºè®®**ï¼šä»Šå¤©åº”è¯¥åšä»€ä¹ˆ

ä¿æŒç®€æ´ï¼Œé‡ç‚¹çªå‡ºå˜åŒ–å’Œè¡ŒåŠ¨é¡¹ã€‚å¦‚æžœæ²¡æœ‰æ˜Žæ˜¾å˜åŒ–ï¼Œç®€å•è¯´"ä»Šæ—¥æ— é‡å¤§å˜åŒ–"å³å¯ã€‚`;
}

module.exports = {
  TREND_SOURCES,
  SEASONAL_CATEGORIES,
  buildSelectionPrompt,
  buildTrendPrompt,
  buildDailyReportPrompt
};
