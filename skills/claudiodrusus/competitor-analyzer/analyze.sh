#!/usr/bin/env bash
# Competitor Analyzer â€” gather competitive intelligence on any company
# Usage: ./analyze.sh <company_name_or_url>
set -euo pipefail

COMPANY="${1:?Usage: ./analyze.sh <company_name_or_url>}"
OUTFILE="competitor-report-$(echo "$COMPANY" | tr ' /' '-' | tr '[:upper:]' '[:lower:]').md"
TIMESTAMP=$(date '+%Y-%m-%d %H:%M')

# Strip protocol for search-friendly name
SEARCH_NAME=$(echo "$COMPANY" | sed 's|https\?://||;s|/.*||;s|www\.||')

echo "ðŸ¦ž Competitor Analyzer â€” Analyzing: $SEARCH_NAME"
echo "================================================="
echo ""

# Function to search via DuckDuckGo HTML (no API key needed)
search() {
  local query="$1"
  curl -sL "https://html.duckduckgo.com/html/?q=$(python3 -c "import urllib.parse; print(urllib.parse.quote('$query'))")" \
    -H "User-Agent: Mozilla/5.0" 2>/dev/null | \
    python3 -c "
import sys, re, html
content = sys.stdin.read()
results = re.findall(r'class=\"result__snippet\">(.*?)</a>', content, re.DOTALL)
for i, r in enumerate(results[:5]):
    text = html.unescape(re.sub(r'<[^>]+>', '', r)).strip()
    if text:
        print(f'- {text}')
" 2>/dev/null || echo "- (search unavailable â€” run with an AI agent for better results)"
}

echo "ðŸ” Searching for company overview..."
OVERVIEW=$(search "$SEARCH_NAME company overview what do they do")

echo "ðŸ’° Searching for pricing info..."
PRICING=$(search "$SEARCH_NAME pricing plans cost")

echo "ðŸ“± Searching for social presence..."
SOCIAL=$(search "$SEARCH_NAME twitter linkedin social media followers")

echo "ðŸ“° Searching for recent news..."
NEWS=$(search "$SEARCH_NAME news announcements 2025 2026")

echo "âš”ï¸ Searching for competitors..."
COMPETITORS=$(search "$SEARCH_NAME competitors alternatives vs")

# Generate report
cat > "$OUTFILE" << EOF
# Competitive Analysis: $SEARCH_NAME
*Generated: $TIMESTAMP*

---

## ðŸ¢ Company Overview
$OVERVIEW

## ðŸ’° Pricing & Plans
$PRICING

## ðŸ“± Social Presence
$SOCIAL

## ðŸ“° Recent News
$NEWS

## âš”ï¸ Competitors & Alternatives
$COMPETITORS

---

## ðŸ“Š Quick Assessment

| Category | Notes |
|----------|-------|
| Market Position | See overview above |
| Pricing Model | See pricing section |
| Social Reach | See social section |
| Recent Momentum | See news section |

---
*Report generated by Competitor Analyzer ðŸ¦ž â€” a ClawHub skill by Shelly*
EOF

echo ""
echo "âœ… Report saved to: $OUTFILE"
echo ""
cat "$OUTFILE"
