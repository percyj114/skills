# Anti-Hallucination 模块

> 防幻觉规则模块 - 确保每个发现都基于真实的代码分析
> 版本: 1.0.0

## 概述

LLM 在代码审计中容易产生"幻觉"，即报告实际不存在的漏洞。本模块定义严格的验证规则，确保每个发现都基于真实的代码分析。

---

## 🔒 核心规则

### 规则 1: 文件存在性验证
```
强制要求: 报告漏洞前必须验证文件存在

✗ 禁止行为:
- 基于"典型项目结构"猜测文件路径
- 假设 config/database.py、app/api.py 等文件存在
- 使用未经验证的文件路径

✓ 正确做法:
- 使用 Glob 工具发现文件
- 使用 Read 工具确认文件内容
- 只报告实际读取过的文件中的漏洞
```

**验证流程**:
```
1. Glob: 发现项目中的文件
2. Read: 读取目标文件内容
3. 分析: 在实际代码中识别漏洞
4. 报告: 使用真实的文件路径和行号
```

### 规则 2: 代码真实性验证
```
强制要求: code_snippet 必须来自实际读取

✗ 禁止行为:
- 凭记忆编造代码片段
- 使用知识库中的示例代码作为项目代码
- 推测代码可能的写法

✓ 正确做法:
- 直接复制 Read 工具返回的代码
- 保持代码格式和缩进
- 包含足够的上下文
```

### 规则 3: 行号准确性验证
```
强制要求: 行号必须在文件实际行数范围内

✗ 禁止行为:
- 编造行号
- 使用估计的行号
- 报告超出文件行数的行号

✓ 正确做法:
- 使用 Read 工具返回的行号
- 如果不确定，重新读取文件确认
```

### 规则 4: 技术栈一致性验证
```
强制要求: 发现必须与项目技术栈一致

✗ 禁止行为:
- 在 Rust 项目中报告 Python 漏洞
- 在纯前端项目中报告数据库漏洞
- 假设项目使用某种框架

✓ 正确做法:
- 先识别项目技术栈
- 只报告与技术栈相关的漏洞
- 不确定时明确标注
```

### 规则 5: 知识库隔离
```
强制要求: 知识库示例 ≠ 项目代码

✗ 幻觉来源:
1. 查询 auth_bypass 知识 → 看到 JWT 示例
2. 没有在项目中找到 JWT 代码
3. 仍然报告 "JWT 认证绕过漏洞"

✓ 正确做法:
1. 知识库用于理解漏洞概念和检测方法
2. 必须在实际代码中找到对应模式
3. 只报告实际看到的漏洞
```

### 核心原则

**Better to miss a vulnerability than report a false positive**
