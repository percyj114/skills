# 架构层面安全检查清单

基于SKILL.md五阶段审计协议的架构层面安全检查清单

## Phase 1: 侦察与绘图检查清单

### 1.1 架构梳理方法

#### 1.1.1 分层架构分析
- [ ] 识别表现层：API接口、前端应用、入口点
- [ ] 识别业务层：服务逻辑、业务规则、权限控制
- [ ] 识别数据层：数据库、缓存、文件存储
- [ ] 识别基础设施层：中间件、容器、云服务

#### 1.1.2 数据流分析
- [ ] 识别输入流：用户输入、外部系统调用、API请求
- [ ] 识别处理流：数据转换、业务逻辑、权限验证
- [ ] 识别输出流：响应返回、数据存储、外部调用

#### 1.1.3 依赖关系分析
- [ ] 识别内部依赖：模块间调用、服务依赖
- [ ] 识别外部依赖：第三方库、API服务、云服务
- [ ] 识别配置依赖：环境变量、配置文件、secrets

### 1.2 Mermaid建模规范

#### 1.2.1 业务流程图
- [ ] 标注Source（数据输入点、用户可控输入）
- [ ] 标注Filter（安全控制、输入验证、权限检查）
- [ ] 标注Service（业务逻辑、数据处理）
- [ ] 标注Sink（数据输出点、外部调用、存储操作）
- [ ] 标注Risk（潜在风险等级、攻击难度）

#### 1.2.2 数据流图
- [ ] 使用不同的颜色标识Source、Filter、Service、Sink
- [ ] 标注数据流方向和格式
- [ ] 标注安全控制点
- [ ] 标注潜在风险点

#### 1.2.3 攻击路径图
- [ ] 标注攻击者入口点
- [ ] 标注漏洞点
- [ ] 标注权限提升路径
- [ ] 标注数据泄露路径
- [ ] 标注系统访问路径

### 1.3 可视化标准

#### 1.3.1 必须包含要素
- [ ] 核心组件：所有关键服务、数据库、中间件
- [ ] 数据流：主要数据传输路径、方向、格式
- [ ] 安全边界：网络隔离、权限边界、加密区域
- [ ] 外部依赖：第三方服务、API、云资源
- [ ] 潜在风险点：标记可能的攻击入口、敏感操作

#### 1.3.2 标注要求
- [ ] Source：数据输入点、用户可控输入
- [ ] Filter：安全控制、输入验证、权限检查
- [ ] Service：业务逻辑、数据处理
- [ ] Sink：数据输出点、外部调用、存储操作
- [ ] Risk：潜在风险等级、攻击难度

#### 1.3.3 架构评估维度
- [ ] 安全性：认证、授权、加密、审计
- [ ] 可靠性：容错、备份、恢复
- [ ] 性能：scalability、响应时间、资源使用
- [ ] 可维护性：代码质量、文档、监控

### 1.4 安全架构评估

#### 1.4.1 系统性缺陷识别
- [ ] 单点故障：关键服务无冗余
- [ ] 安全边界缺失：网络隔离不足
- [ ] 权限模型缺陷：过于宽松的权限设置
- [ ] 加密策略不当：敏感数据未加密

#### 1.4.2 架构改进建议
- [ ] 防御纵深：多层安全控制
- [ ] 最小权限：按需分配权限
- [ ] 安全默认：默认安全配置
- [ ] 可观测性：安全监控、审计日志

## Phase 2: 并行模式匹配检查清单

### 2.1 网络安全架构
- [ ] 网络隔离：不同安全级别系统隔离
- [ ] 防火墙配置：合理的入站出站规则
- [ ] DMZ区域：外部可访问服务隔离
- [ ] 内部网络分段：减少攻击面
- [ ] 网络加密：网络传输加密
- [ ] 网络监控：网络流量监控和异常检测

### 2.2 数据安全架构
- [ ] 数据分类：敏感数据识别和保护
- [ ] 加密策略：传输和存储加密
- [ ] 数据脱敏：非生产环境数据处理
- [ ] 备份安全：备份数据加密和访问控制
- [ ] 数据销毁：安全的数据销毁策略
- [ ] 数据访问审计：数据访问审计和监控

### 2.3 身份与访问管理架构
- [ ] 集中认证：统一身份管理
- [ ] 授权策略：基于角色的访问控制
- [ ] 特权访问管理：管理员权限控制
- [ ] 身份验证强度：多因素认证
- [ ] 身份生命周期管理：用户身份生命周期管理
- [ ] 访问控制审计：访问控制审计和监控

### 2.4 应用架构安全
- [ ] 分层架构：清晰的责任分离
- [ ] 微服务安全：服务间通信加密和认证
- [ ] API网关：集中的API安全控制
- [ ] 容器安全：容器镜像扫描和运行时安全
- [ ] 无服务器安全：无服务器架构的安全配置
- [ ] 应用隔离：应用间的安全隔离

### 2.5 业务逻辑安全
- [ ] 业务规则验证：服务端业务逻辑校验
- [ ] 交易安全：金额和操作限制
- [ ] 敏感操作：二次确认机制
- [ ] 业务流程：状态转换安全
- [ ] 业务逻辑漏洞：业务逻辑中的安全漏洞
- [ ] 业务连续性：业务连续性和灾难恢复

### 2.6 IAM与访问控制
- [ ] 根账户不使用：生产环境不使用根账户
- [ ] MFA启用：所有特权账户启用MFA
- [ ] 服务账户使用角色：服务账户使用角色而非长期凭证
- [ ] 最小权限策略：IAM策略遵循最小权限原则
- [ ] 定期访问审查：定期进行访问审查
- [ ] 凭证轮换：未使用的凭证轮换或移除
- [ ] OIDC认证：CI/CD使用OIDC而非长期凭证

### 2.7 网络安全
- [ ] 数据库不可公开访问：数据库不公开访问
- [ ] SSH/RDP限制：SSH/RDP端口限制到VPN/bastion
- [ ] 安全组配置：安全组遵循最小权限原则
- [ ] 网络ACL配置：配置网络ACL
- [ ] VPC流日志：启用VPC流日志
- [ ] 端口限制：只开放必要端口
- [ ] 入站规则：严格的入站规则
- [ ] 出站规则：合理的出站规则

### 2.8 日志与监控
- [ ] 日志启用：所有服务启用CloudWatch/日志记录
- [ ] 认证失败记录：记录认证失败尝试
- [ ] 管理操作审计：审计管理操作
- [ ] 日志保留：配置日志保留（合规要求90天以上）
- [ ] 告警配置：为可疑活动配置告警
- [ ] 日志集中：日志集中且防篡改
- [ ] 安全事件类型：记录所有安全事件类型

### 2.9 CI/CD管道安全
- [ ] 密钥扫描：管道中进行密钥扫描
- [ ] 依赖漏洞扫描：进行依赖漏洞扫描
- [ ] 容器镜像扫描：进行容器镜像扫描（如适用）
- [ ] 分支保护规则：强制执行分支保护规则
- [ ] 代码审查要求：合并前要求代码审查
- [ ] 签名提交强制：强制签名提交
- [ ] 最小权限：管道使用最小权限
- [ ] 供应链安全：确保供应链安全

### 2.10 CDN与边缘安全
- [ ] WAF启用：启用WAF并配置OWASP规则
- [ ] 速率限制配置：配置速率限制
- [ ] 机器人保护：机器人保护激活
- [ ] DDoS防护：DDoS防护启用
- [ ] 安全头配置：配置安全头
- [ ] SSL/TLS模式：SSL/TLS严格模式启用
- [ ] Cloudflare配置：正确配置Cloudflare

### 2.11 备份与灾难恢复
- [ ] 自动备份配置：配置自动每日备份
- [ ] 备份保留：备份保留符合合规要求
- [ ] 时间点恢复：启用时间点恢复
- [ ] 备份测试：每季度进行备份测试
- [ ] 灾难恢复计划：记录灾难恢复计划
- [ ] RPO和RTO定义：定义并测试RPO和RTO
- [ ] 删除保护：启用删除保护

## Phase 3: 深度污点追踪检查清单

### 3.1 架构层面的数据流追踪
- [ ] 验证跨层数据流完整性
- [ ] 验证服务间通信安全
- [ ] 验证数据转换和验证点
- [ ] 验证外部调用安全性

### 3.2 架构层面的优先级决策
- [ ] 优先审计公共工具类（如HttpUtil、FileUtil）
- [ ] 优先审计认证和授权服务
- [ ] 优先审计数据处理服务
- [ ] 优先审计外部API调用

### 3.3 架构层面的污点分析
- [ ] 识别架构层面的Source点
- [ ] 识别架构层面的Filter点
- [ ] 识别架构层面的Service点
- [ ] 识别架构层面的Sink点
- [ ] 验证架构层面的污点传播路径

## Phase 4: 验证与攻击链构建检查清单

### 4.1 架构层面的验证
- [ ] 验证架构层面的数据流完整性
- [ ] 验证架构层面的安全控制有效性
- [ ] 验证架构层面的隔离性
- [ ] 验证架构层面的加密策略

### 4.2 架构层面的攻击链构建
- [ ] 构建跨层攻击链
- [ ] 构建跨服务攻击链
- [ ] 构建跨组件攻击链
- [ ] 评估架构层面的综合风险

### 4.3 架构层面的漏洞环境模拟
- [ ] 提供架构层面的复现环境
- [ ] 提供架构层面的攻击链示例
- [ ] 验证架构层面的漏洞影响
- [ ] 评估架构层面的修复方案

## Phase 5: 结构化报告检查清单

### 5.1 架构层面的报告结构
- [ ] 架构概览
- [ ] 安全架构分析
- [ ] 攻击面评估
- [ ] 架构风险点
- [ ] 架构改进建议

### 5.2 架构层面的分级标准
- [ ] 评估架构层面的风险等级
- [ ] 评估架构层面的影响范围
- [ ] 评估架构层面的修复复杂度
- [ ] 评估架构层面的业务影响

### 5.3 架构层面的DevSecOps集成
- [ ] 提供架构层面的安全改进计划
- [ ] 提供架构层面的DevSecOps集成方案
- [ ] 提供架构层面的监控建议
- [ ] 提供架构层面的持续改进方案

## 附录：架构安全最佳实践

### A. 网络安全最佳实践
- 实施网络分段和隔离
- 配置防火墙和安全组规则
- 启用网络加密和监控
- 实施DMZ和堡垒机

### B. 数据安全最佳实践
- 实施数据分类和加密
- 配置数据备份和恢复
- 实施数据访问审计
- 实施数据脱敏和销毁

### C. 身份与访问管理最佳实践
- 实施集中身份管理
- 实施多因素认证
- 实施基于角色的访问控制
- 实施最小权限原则

### D. 应用安全最佳实践
- 实施分层架构
- 实施微服务安全
- 实施API网关
- 实施容器安全

### E. 监控与日志最佳实践
- 实施集中日志管理
- 实施安全事件监控
- 实施异常行为检测
- 实施日志完整性保护