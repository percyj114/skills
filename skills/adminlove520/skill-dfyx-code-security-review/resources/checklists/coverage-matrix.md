# Security Coverage Matrix (审计后自检）

> Phase 2A（LLM 自由审计）完成后，对照此矩阵验证维度覆盖。
> 未覆盖维度需加载 `{language}.md` 中对应维度的语义提示并补充审计。

| # | 维度 | 关键问题 | 已覆盖? | 发现数 |
|---|------|---------|---------|--------|
| D1 | 注入 | 用户输入是否能到达 SQL/Cmd/LDAP/SSTI/SpEL 执行点？ | [ ] | |
| D2 | 认证 | Token/Session 生成、验证、过期是否完整？密钥是否安全？ | [ ] | |
| D3 | 授权 | 每个敏感操作是否验证用户归属？CRUD 权限是否一致？ | [ ] | |
| D4 | 反序列化 | 是否存在不受信数据的反序列化？Gadget 链是否可达？ | [ ] | |
| D5 | 文件操作 | 上传/下载/读取路径是否可控？是否有路径遍历？ | [ ] | |
| D6 | SSRF | 服务端 HTTP 请求的 URL 是否用户可控？协议是否限制？ | [ ] | |
| D7 | 加密 | 硬编码密钥/IV？ECB/CBC-no-MAC？弱KDF？RSA-PKCS1v1.5？证书校验绕过？ | [ ] | |
| D8 | 配置 | 调试接口(Actuator/pprof)是否暴露？CORS 是否过宽？错误堆栈是否泄露？ | [ ] | |
| D9 | 业务逻辑 | 竞态条件？支付金额可篡改？流程可跳过？Mass Assignment？IDOR/水平越权？CRUD 权限注解完整性？数据导出范围？ | [ ] | |
| D10 | 供应链 | 依赖是否有已知 CVE？版本是否在安全范围？ | [ ] | |

## 使用规则

- **未覆盖维度** → 加载 `resources/checklists/{language}.md` 中对应 `## D{N}` 段落的语义提示，补充审计
- **Critical 维度** (D1-D6) 必须全部覆盖
- **High 维度** (D7-D8) 强烈建议覆盖
- **High 维度** (D9) 有后台管理/多角色/多租户/支付逻辑的项目必查
- **Medium 维度** (D10) 按项目类型可选（有外部依赖则 D10 必查）

## 覆盖标准（按审计策略分轨）

### Sink-driven 维度 (D1, D4, D5, D6)
- **已覆盖** = 核心 Sink 类别均被搜索 + 有数据流追踪 + Sink 扇出率 ≥ 30%
- **浅覆盖** = 搜索过但 Sink 类别有遗漏 / 仅 Grep 未追踪 / 扇出率 < 30%
- **未覆盖** = 该维度未被任何 Agent 搜索

### Control-driven 维度 (D3, D9)
- **已覆盖** = 端点审计率 ≥ 50%(deep) / ≥ 30%(standard) + 至少 3 种资源类型执行了 CRUD 权限一致性对比
- **浅覆盖** = 仅 Grep 搜索 pattern 但未系统枚举端点验证（⚠️ 仅靠 sink-driven 搜索 D3/D9 不算覆盖）
- **未覆盖** = 未执行 Control-driven 审计
- **D3/D9 Agent 必须加载** `resources/knowledge/phase2_deep_methodology.md` Phase 2.5-2.6

### Config-driven 维度 (D2, D7, D8, D10)
- **已覆盖** = 核心配置项均已检查 + 版本/算法已对比安全基线
- **浅覆盖** = 仅检查了部分配置 / 未深入验证
- **未覆盖** = 该维度未被任何 Agent 检查

## 终止判定

- 覆盖矩阵 ≥ 8/10 维度 AND 发现 ≥ 10 → 可进入 REPORT
- 覆盖矩阵 < 5/10 → 必须补充审计
- D1-D3 任一未覆盖 → 不可进入 REPORT（注入+认证+授权是核心三角）
